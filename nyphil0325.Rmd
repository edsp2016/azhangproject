---
title: "Reflections on NY Phil ¨C The NY Phil as a lens on changes in US society"
output: html_document
---
Around the turn of the century, New York City became the arts center of the world. Its establishment not only encouraged the flourishing of American musicians but also attracted musicians from all over the world to NYC. NY Philharmonic as an important art and culture institution, reflects the social and economic changes of the United States society over time. In this study I focus on NY Philharmonic data from three perspectives: 1. the contemporality and the economic change of the US; 2. the nationality of composers whose works are performed by NY Philharmonic in relation to the political enviroments of the US; 3. the rise of women composers over time

###1. Getting data from NY Philharmonic's github page
First of all, I read the XML file from NY Philharmonic's github page (https://github.com/nyphilarchive/PerformanceHistory/blob/master/Programs/complete.xml) and found the number of every composers in all season and put them in a table. 
```{r, eval=FALSE}
require("XML")
require(mosaic)
xmlfile <- xmlParse("complete.xml",encoding="UTF-8")
rootnode = xmlRoot(xmlfile) #gives content of root

incrementComp <- function(composer_stats, c, season){
  if (is.null(composer_stats[c, season])) {
    composer_stats[c, season] <- 1
  } else if (is.na(composer_stats[c,season])) {
    composer_stats[c, season] <- 1
  } else {
    composer_stats[c, season] <- composer_stats[c, season] + 1
  }
  return(composer_stats)
}

composerBySeasonComplete <- data.frame()
for (seas in 1:xmlSize(rootnode)) {
  # DEBUG: cat(seas, "\n")
  firstlist <- xmlToList(rootnode[[seas]])
  season <- firstlist$season
  season <- paste("Season",season,sep=".")
  works <- firstlist$worksInfo
  if (is.list(works)) {     # sometimes works is actually empty
      for (i in 1:length(works)) {
        if (!is.null(works[[i]]$composerName)) {    #sometimes there is no composer
          composerBySeasonComplete <- incrementComp(composerBySeasonComplete, works[[i]]$composerName,season)
        }
      }
    }
}
colnames(composerBySeasonComplete)[1]="composers"
write.csv(composerBySeasonComplete, "composerBySeasonComplete.csv")
```

the cleaned data look like:
```{r}
composerBySeasonComplete <- read.csv("composerBySeasonComplete.csv", row.names=1, encoding="UTF-8")
composerBySeasonComplete[1:5,1:5]
```

To get a general sense of the data, I decide to order composers by the number of works that got performed in descending order. 
```{r}
SumComp=rowSums(composerBySeasonComplete[2:175],na.rm=TRUE)
SumComp=cbind(composerBySeasonComplete[1],SumComp)
SumComp1=SumComp[order(-SumComp$SumComp),]
```

The following graph shows that most of the composers' works got performed fewer than ten times, and only 16 composers' works are performed more than 1000 times. Therefore, I expect the composers are very diverse. 
```{r}
require(mosaic)
nrow(SumComp1)
hist(SumComp1$SumComp)

comp1000=filter(SumComp1,SumComp>=1000)
nrow(comp1000)
comp1000

compl1000=filter(SumComp1,SumComp<=10)
nrow(compl1000)
hist(compl1000$SumComp)
```

### 2.Computing popularity score

Graph of number of performance per year
```{r}
SumSeas=colSums(composerBySeasonComplete[2:175],na.rm=TRUE)
require(ggplot2)
qplot(seq_along(as.double(SumSeas)),as.double(SumSeas))+geom_line()+scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

Because the number of performance change year by year, I computed a "popularity score" to normalize by total number of performances. I got the popularity score by dividing the number of performances for each composers in each season by the total number of performance in each season.

```{r,eval=FALSE}
require(base)
composerBySeasonComplete[is.na(composerBySeasonComplete)] <- 0
composerBySeasonComplete1=composerBySeasonComplete[2:175]
composerBySeasonComplete2=composerBySeasonComplete[1]
popScoreComposerComplete=data.frame()
totalNumConcert=colSums(composerBySeasonComplete1, na.rm=TRUE)
for ( i in 1:2652){
  popScoreComposerComplete[i,]=composerBySeasonComplete1[i,]/totalNumConcert
  i=i+1
}
popScoreComposerComplete=cbind(composerBySeasonComplete2,popScoreComposerComplete)
write.csv(popScoreComposerComplete,"popScoreComposerComplete.csv")
```

the popularity score table looks like:
```{r}
popScoreComposerComplete <- read.csv("~/GitHub/azhangproject/popScoreComposerComplete.csv", row.names=1, encoding="UTF-8")
popScoreComposerComplete[1:5,1:5]
```

the top twenty list in the popularity score table does not differ much from the composers by season table. 
```{r}
popScoreSumComp=rowSums(popScoreComposerComplete[2:175],na.rm=TRUE)
popScoreSumComp=cbind(popScoreComposerComplete[1],popScoreSumComp)
popScoreSumComp1=popScoreSumComp[order(-popScoreSumComp$popScoreSumComp),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(popScoreSumComp1,20)
```


```{r}
require(stringr)
popScoreComposerComplete$composers=str_replace_all(popScoreComposerComplete$composers,"[^[:graph:]]", " ") 
popScoreComposerComplete$composers=gsub("  ", " ", popScoreComposerComplete$composers, fixed = TRUE)

composerBySeasonComplete$composers=str_replace_all(composerBySeasonComplete$composers,"[^[:graph:]]", " ") 
composerBySeasonComplete$composers=gsub("  ", " ", composerBySeasonComplete$composers, fixed = TRUE)
```


# 3. The contemporaneousness of NY Philharmonic reportories and the change of US economy
Even though NY Philharmonic is a classical music institution, it is still important for it to not only play established composers' works but also play contemporary composers' work. Especially, the composer in residence program at NY philharmonic shows that NY philharmonic is working on promoting living composers' works.  

Only at economically stable and affluent times are people able to invest on music and art education. This will increase the number of contemporary composers. With the additional sources of new music we should see this reflected by a relative increase in the proportion of works by contemporary rather than deceased composers being performed. Therefore, we should look for relationships between US economic measurements like GDP and the proportion of contemporary works performed. 

For this part, I am scraping wikipedia pages. The web pages' structures for different time periods are different. I scraped the classical era composer's birth and death year page (https://en.wikipedia.org/wiki/List_of_Classical-era_composers) in python with the following code.
```{r}
library(png)
library(grid)
img04 <- readPNG("classicalCode.png")
grid.raster(img04)
```

```{r}
classical=read.csv("classical.csv",header=FALSE,encoding="UTF-8")
classical1=strsplit(as.character(classical$V1)," ")
year=list(rep(0,length(classical1)))
for (i in 1: length(classical1)){
  year[i]=classical1[[i]][length(classical1[[i]])]
}

yearD=list(rep(0,length(classical1)))
for (i in 1:length(year)){
  yearD[i]=paste(strsplit(year[[i]],"")[[1]][7],strsplit(year[[i]],"")[[1]][8],
  strsplit(year[[i]],"")[[1]][9],strsplit(year[[i]],"")[[1]][10],sep = "")
}
Year.of.death=unlist(yearD)

Name1=list(rep(0,length(classical1)))
for (i in 1:length(classical1)){
  name=classical1[[i]][1:length(classical1[[i]])-1]
  Lname=name[length(name)]
  Fname=name[1:length(name)-1]
  Fname=paste(as.list(Fname), collapse=" ")
  FullName=paste(c(as.list(Lname),as.list(Fname)),collapse=", ")
  Name1[i]=FullName
}
classical3=cbind(Year.of.death,Name1)
classical3=as.data.frame((classical3))
classical4=suppressWarnings(subset(classical3,Year.of.death>=1842))
#names(classical4)[names(classical4)=="Year.of.death"] <- "Year.of.death"
```

I use rvest to scrape the page for romantic era composers page(https://en.wikipedia.org/wiki/List_of_Romantic-era_composers), twentieth century composers' page(https://en.wikipedia.org/wiki/List_of_20th-century_classical_composers), and twenty first century composers' page (https://en.wikipedia.org/wiki/List_of_21st-century_classical_composers). 

```{r, eval=FALSE}
require(mosaic)
library(rvest)
url <- 'https://en.wikipedia.org/wiki/List_of_20th-century_classical_composers'
html <- read_html(url, encoding = "UTF-8")
tables <- html_table(html, fill=TRUE)
tables=tables[[2]]
tables=tables[1:3]
tables$Name=str_replace_all(tables$Name,"[^[:graph:]]", " ")
for (i in 1:nrow(tables)){
  test=unlist(strsplit(tables$Name[i],""))
  n=(length(test)+1)/2
  test1=test[1:n]
  test2=do.call(paste, c(as.list(test1), sep=""))
  tables$Name1[i]=test2
}
twentiethC=tables[2:4]
# twentiethCS=twentiethC[2:3]
# twentiethCS$"Year of death"=as.character(twentiethCS$"Year of death")
# twentiethCS$"Year of death"[is.na(twentiethCS$"Year of death")]=2016
# dyear=rbind(classical4,twentiethCS)
```

```{r,eval=FALSE}
url <- 'https://en.wikipedia.org/wiki/List_of_21st-century_classical_composers'
html <- read_html(url, encoding="UTF-8")
tables <- html_table(html, fill=TRUE)
tables=tables[[2]]
tables=tables[1:3]
#write.csv(tables,"test0328.csv")
#tables=read.csv("test0328.csv", encoding="UTF-8")
for (i in 1:nrow(tables)){
  test=unlist(strsplit(tables$Names[i],""))
  n=(length(test)+1)/2
  test1=test[1:n]
  test2=do.call(paste, c(as.list(test1), sep=""))
  tables$Name1[i]=test2
}
twentyfirstC=tables[2:4]
# #twentiethC <- read.csv("twentiethC.csv",row.names=1, encoding="UTF-8")
# #twentyfirstC <- read.csv("twentyfirstC.csv",row.names=1,header=FALSE,encoding="UTF-8")
# twentyfirstC$Death=as.character(twentyfirstC$Death)
# twentyfirstC$Death[is.na(twentyfirstC$Death)]=2016
# names(twentyfirstC)[names(twentyfirstC)=="Death"] <- "Year.of.death"
# twentyfirstC=twentyfirstC[2:3]
# #names(twentyfirstC)[names(twentyfirstC)=="V4"] <- "Name1"
# dyear=rbind(dyear,twentyfirstC)
```

```{r}
twentiethC <- read.csv("twentiethC.csv",row.names=1, encoding="UTF-8")
twentiethCS=twentiethC[2:3]
twentiethCS$"Year.of.death"=as.character(twentiethCS$"Year.of.death")
twentiethCS$"Year.of.death"[is.na(twentiethCS$"Year.of.death")]=2016
dyear=rbind(classical4,twentiethCS)

twentyfirstC <- read.csv("twentyfirstC.csv",row.names=1,header=FALSE,encoding="UTF-8")
twentyfirstC$V3=as.character(twentyfirstC$V3)
twentyfirstC$V3[is.na(twentyfirstC$V3)]=2016
names(twentyfirstC)[names(twentyfirstC)=="V3"] <- "Year.of.death"
twentyfirstC=twentyfirstC[2:3]
names(twentyfirstC)[names(twentyfirstC)=="V4"] <- "Name1"
dyear=rbind(dyear,twentyfirstC)
```

```{r}
comp=composerBySeasonComplete[2:175]
test=list(rep(0, nrow(comp)))
for (i in 1: nrow(comp)){
    test[i]<- min(which(!is.na(comp[i,])))
}
test=unlist(test)

firstPerf=colnames(comp)[test]

firstPerf1=list(rep(0, nrow(comp)))
for (i in 1:length(firstPerf)){
  firstPerf1[i]=(unlist(strsplit(firstPerf[i],"\\."))[2])
}
firstPerf1=unlist(firstPerf1)
Name1=as.character(composerBySeasonComplete$composers)
compContemp=as.data.frame(cbind(Name1,firstPerf1))

test=merge(compContemp,dyear)
l=c()
for (i in 1:nrow(test)){
  if (as.numeric(test[i,2])<as.numeric(test[i,3])){
    l=c(l,i)
  }
}
contempComp=test[l,]
contempComp=contempComp$Name1

l=c()
for (i in 1:length(contempComp)){
  l=c(l,which(contempComp[i]==popScoreComposerComplete$composers))
}
contem=unique(popScoreComposerComplete[l,])
SumSeasContemp=colSums(contem[2:175],na.rm=TRUE)
qplot(seq_along(as.double(SumSeasContemp)),as.double(SumSeasContemp))+ylim(0,1)+geom_area(colour="black")+geom_line()+scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```
the graph shows that the proportion of works of composers who is contemporary of their time increase over the time. 


## 4.Composer Nationalities and Politics and Economy 
In this part, I want to ask several questions:  
1. Does the number of German composers' work decrease during WWI?  
2. Does the number of German composers' work decrease during WWII?  
3. Does the number of Russian composers' work decrease during the cold war?  
4. As the economy rise in asian and latin american countries, will the number of their works increase over time? 

To do this we need to identify the nationality of composers whose works are performed by the NY Philharmic. The NY Philharmonic data do not have the nationalities of composers. Therefore, I scraped wikipedia page and got a lists of composers nationalities data.
I got the most of the composers nationality scores by scraping this page and the links in the page: (https://en.wikipedia.org/wiki/Category:Classical_composers_by_nationality) using the following python code
```{r}
img02 <- readPNG("2016-03-26b.png")
grid.raster(img02)
```

However, some pages, for example the American composer page (https://en.wikipedia.org/w/index.php?title=Category:American_classical_composers) has multiple pages, and it is hard to go through every page in my code. So I scraped every page by clicking by hand and rbind them together in R

```{r}
img03 <- readPNG("scrapeNationality2.png")
grid.raster(img03)
```

####American.
I stacked the data from multiple pages, cleaned them and matched them with the popularity score table and computed the proportion of the number of American composers whose works are performed by the NY Philharmonic over total number of works performed by the NY Philharmonic over time.
```{r}
require(ggplot2)
american1=read.csv("americantest1.csv", header = FALSE ,encoding = "UTF-8")
american2=read.csv("americantest2.csv", header = FALSE ,encoding = "UTF-8")
american3=read.csv("americantest3.csv", header = FALSE ,encoding = "UTF-8")
american4=read.csv("americantest4.csv", header = FALSE ,encoding = "UTF-8")
american5=read.csv("americantest5.csv", header = FALSE ,encoding = "UTF-8")
american6=read.csv("americantest6.csv", header = FALSE ,encoding = "UTF-8")
american7=read.csv("americantest7.csv", header = FALSE ,encoding = "UTF-8")
american=c(american1,american2,american3,american4,american5,american6,american7)
american=unique(unlist(american))

#american0 <- as.factor(american[,1])
american1.0=gsub("\\(composer)|\\(pianist)|\\(conductor)|\\(guitarist)|\\(musician)|\\ (musicologist)|\\(singer-songwriter)|\\ (Fluxus musician)","",american)
american1.1=strsplit(as.character(american1.0)," ")

#matching method one. change the name format of american composer list into last name ",  " first name and exact match with pop score table
american1.2=list(rep(0,length(american1.1)))

for ( i in 1:length(american1.1)){
  if (length(american1.1[[i]])>1)
    #Lname[i]=american1.1[[i]][length(american1.1[[i]])]
    #Fname[i]=paste(american1.1[[i]][1:length(american1.1[[i]])-1], collapse=" ")
    american1.2[i]=paste(american1.1[[i]][length(american1.1[[i]])],paste(american1.1[[i]][1:length(american1.1[[i]])-1], collapse=" "),sep=", ")
}
american1.2=american1.2[!is.na(american1.2)]
l=list(rep(0, length(american1.2)))
l=c()
for ( i in 1:length(american1.2)){
  l=c(l,which(american1.2[i]==popScoreComposerComplete$composers))
}
americans=popScoreComposerComplete$composers[l]
americansPop=popScoreComposerComplete[l,]
americansPopSum=colSums(americansPop[2:175])
qplot(seq_along(americansPopSum),americansPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```
The graph shows a general increase of the proportion of the number of American composers over total number of composers over time, and the next step is to see the proportion of the number of American composers over the number of living composers over time. 

The top twenty american composers are
```{r}
americanTop=rowSums(americansPop[2:175],na.rm=TRUE)
americanTop=cbind(as.data.frame(americans)[1],americanTop)
americanTop1=americanTop[order(-americanTop$americanTop),]
head(americanTop1,20)
```
contemporary american composers 
```{r}
# comp=composerBySeasonComplete[2:175]
# test=list(rep(0, nrow(comp)))
# for (i in 1: nrow(comp)){
#     test[i]<- min(which(!is.na(comp[i,])))
# }
# test=unlist(test)
# 
# firstPerf=colnames(comp)[test]
# 
# firstPerf1=list(rep(0, nrow(comp)))
# for (i in 1:length(firstPerf)){
#   firstPerf1[i]=(unlist(strsplit(firstPerf[i],"\\."))[2])
# }
# firstPerf1=unlist(firstPerf1)
# Name1=as.character(composerBySeasonComplete$composers)
# compContemp=as.data.frame(cbind(Name1,firstPerf1))
# 
# test=merge(compContemp,dyear)
# l=c()
# for (i in 1:nrow(test)){
#   if (as.numeric(test[i,2])<as.numeric(test[i,3])){
#     l=c(l,i)
#   }
# }
# contempComp=test[l,]
# contempComp=contempComp$Name1
# 
# l=c()
# for (i in 1:length(contempComp)){
#   l=c(l,which(contempComp[i]==popScoreComposerComplete$composers))
# }
# contem=unique(popScoreComposerComplete[l,])
l=c()
for ( i in 1:length(american1.2)){
  l=c(l,which(american1.2[i]==contem$composers))
}
contemAmer=contem$composers[l]
contemAmerPop=contem[l,]
contemAmerPopSum=colSums(contemAmerPop[2:175])
qplot(seq_along(contemAmerPopSum),contemAmerPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
contemAmerPop=rowSums(contemAmerPop[2:175],na.rm=TRUE)
contemAmerPopTop=cbind(as.data.frame(contemAmer)[1],contemAmerPop)
contemAmerPopTop1=contemAmerPopTop[order(-contemAmerPopTop$contemAmerPop),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(contemAmerPopTop1,20)
```


####Germany.
```{r}
german1=read.csv("germantest1.csv", header = FALSE ,encoding = "UTF-8")
german2=read.csv("germantest2.csv", header = FALSE ,encoding = "UTF-8")
german3=read.csv("germantest3.csv", header = FALSE ,encoding = "UTF-8")
german4=read.csv("germantest4.csv", header = FALSE ,encoding = "UTF-8")
german5=read.csv("germantest5.csv", header = FALSE ,encoding = "UTF-8")

german=c(german1,german2,german3,german4,german5)
german=unique(unlist(german))
german1.0=gsub("\\(composer)","",german)
german1.0=gsub("\\(baroque composer)","",german1.0)
german1.0=gsub("\\(Altstadt Kantor)","",german1.0)
german1.0=gsub("\\(Morean)","",german1.0)
german1.0=gsub("\\(1772¨C1806)","",german1.0)
german1.0=gsub("\\(conductor)","",german1.0)
german1.0=gsub("\\(the elder)","",german1.0)
german1.0=gsub("\\(the younger)","",german1.0)
german1.0=gsub("\\(musician)","",german1.0)
german1.0=gsub("\\(organist)","",german1.0)
german1.0=gsub("\\(guitarist)","",german1.0)
german1.0=gsub("\\(musician at Arnstadt)","",german1.0)
german1.1=strsplit(as.character(german1.0)," ")

#matching method one. change the name format of american composer list into last name ",  " first name and exact match with pop score table
german1.2=list(rep(0,length(german1.1)))
for ( i in 1:length(german1.1)){
  if (length(german1.1[[i]])>1){
    german1.2[i]=paste(german1.1[[i]][length(german1.1[[i]])],paste(german1.1[[i]][1:length(german1.1[[i]])-1], collapse=" "),sep=", ")
  }
}
german1.2=german1.2[!is.na(german1.2)]

l=c()
for ( i in 1:length(german1.2)){
  l=c(l,which(german1.2[i]==popScoreComposerComplete$composers))
}
german=popScoreComposerComplete$composers[l]
germanPop=popScoreComposerComplete[l,]
germanPopSum=colSums(germanPop[2:175])
qplot(seq_along(germanPopSum),germanPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
germanTop=rowSums(germanPop[2:175],na.rm=TRUE)
germanTop=cbind(as.data.frame(german)[1],germanTop)
germanTop1=germanTop[order(-germanTop$germanTop),]
head(germanTop1,20)
```
The top twenty american composers are
```{r}
americanTop=rowSums(americansPop[2:175],na.rm=TRUE)
americanTop=cbind(as.data.frame(americans)[1],americanTop)
americanTop1=americanTop[order(-americanTop$americanTop),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(americanTop1,20)
```
contemporary german composers 
```{r}
# comp=composerBySeasonComplete[2:175]
# test=list(rep(0, nrow(comp)))
# for (i in 1: nrow(comp)){
#     test[i]<- min(which(!is.na(comp[i,])))
# }
# test=unlist(test)
# 
# firstPerf=colnames(comp)[test]
# 
# firstPerf1=list(rep(0, nrow(comp)))
# for (i in 1:length(firstPerf)){
#   firstPerf1[i]=(unlist(strsplit(firstPerf[i],"\\."))[2])
# }
# firstPerf1=unlist(firstPerf1)
# Name1=as.character(composerBySeasonComplete$composers)
# compContemp=as.data.frame(cbind(Name1,firstPerf1))
# 
# test=merge(compContemp,dyear)
# l=c()
# for (i in 1:nrow(test)){
#   if (as.numeric(test[i,2])<as.numeric(test[i,3])){
#     l=c(l,i)
#   }
# }
# contempComp=test[l,]
# contempComp=contempComp$Name1
# 
# l=c()
# for (i in 1:length(contempComp)){
#   l=c(l,which(contempComp[i]==popScoreComposerComplete$composers))
# }
# contem=unique(popScoreComposerComplete[l,])
l=c()
for ( i in 1:length(german1.2)){
  l=c(l,which(german1.2[i]==contem$composers))
}
contemGerm=contem$composers[l]
contemGermPop=contem[l,]
contemGermPopSum=colSums(contemGermPop[2:175])
qplot(seq_along(contemGermPopSum),contemGermPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
contemGermPop=rowSums(contemGermPop[2:175],na.rm=TRUE)
contemGermPopTop=cbind(as.data.frame(contemGerm)[1],contemGermPop)
contemGermPopTop1=contemGermPopTop[order(-contemGermPopTop$contemGermPop),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(contemGermPopTop1,20)
```

#####Wagner
```{r}
wagner=as.numeric(popScoreComposerComplete[81,2:175])
qplot(seq_along(wagner),wagner)+geom_line()+geom_area(colour="black")+ylim(0,1)+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

####Russian
```{r}
russian1=read.csv("russiantest1.csv", header = FALSE ,encoding = "UTF-8")
russian2=read.csv("russiantest2.csv", header = FALSE ,encoding = "UTF-8")
russian=c(russian1,russian2)
russian=unique(unlist(russian))

russian1.0=gsub("\\(composer)","",russian)
russian1.0=gsub("\\(conductor)","",russian1.0)
russian1.1=strsplit(as.character(russian1.0)," ")

russian1.2=list(rep(0,length(russian1.1)))
for ( i in 1:length(russian1.1)){
  if (length(russian1.1[[i]])>1)
    russian1.2[i]=paste(russian1.1[[i]][length(russian1.1[[i]])],paste(russian1.1[[i]][1:length(russian1.1[[i]])-1], collapse=" "),sep=", ")
}
russian1.2=russian1.2[!is.na(russian1.2)]
l=c()
for ( i in 1:length(russian1.2)){
  l=c(l,which(russian1.2[i]==popScoreComposerComplete$composers))
}

russian=popScoreComposerComplete$composers[l]
russianPop=popScoreComposerComplete[l,]
russianPopSum=colSums(russianPop[2:175])
qplot(seq_along(russianPopSum),russianPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))

#russian=composerBySeasonComplete$composers[l]
#russianPop=composerBySeasonComplete[l,]
#russianPopSum=colSums(russianPop[2:175])
#qplot(seq_along(russianPopSum),russianPopSum)
#+geom_line()+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
russianTop=rowSums(russianPop[2:175],na.rm=TRUE)
russianTop=cbind(as.data.frame(russian)[1],russianTop)
russianTop1=russianTop[order(-russianTop$russianTop),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(russianTop1,20)
```

contemporary russian composers 
```{r}
# comp=composerBySeasonComplete[2:175]
# test=list(rep(0, nrow(comp)))
# for (i in 1: nrow(comp)){
#     test[i]<- min(which(!is.na(comp[i,])))
# }
# test=unlist(test)
# 
# firstPerf=colnames(comp)[test]
# 
# firstPerf1=list(rep(0, nrow(comp)))
# for (i in 1:length(firstPerf)){
#   firstPerf1[i]=(unlist(strsplit(firstPerf[i],"\\."))[2])
# }
# firstPerf1=unlist(firstPerf1)
# Name1=as.character(composerBySeasonComplete$composers)
# compContemp=as.data.frame(cbind(Name1,firstPerf1))
# 
# test=merge(compContemp,dyear)
# l=c()
# for (i in 1:nrow(test)){
#   if (as.numeric(test[i,2])<as.numeric(test[i,3])){
#     l=c(l,i)
#   }
# }
# contempComp=test[l,]
# contempComp=contempComp$Name1
# 
# l=c()
# for (i in 1:length(contempComp)){
#   l=c(l,which(contempComp[i]==popScoreComposerComplete$composers))
# }
# contem=unique(popScoreComposerComplete[l,])
l=c()
for ( i in 1:length(russian1.2)){
  l=c(l,which(russian1.2[i]==contem$composers))
}
contemRussian=contem$composers[l]
contemRussianPop=contem[l,]
contemRussianPopSum=colSums(contemRussianPop[2:175])
qplot(seq_along(contemRussianPopSum),contemRussianPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
contemRussianPop=rowSums(contemRussianPop[2:175],na.rm=TRUE)
contemRussianPopTop=cbind(as.data.frame(contemRussian)[1],contemRussianPop)
contemRussianPopTop1=contemRussianPopTop[order(-contemRussianPopTop$contemRussianPop),]
#test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(contemRussianPopTop1,20)
```

#####shostakovich
```{r}
test=grep("Shostakovich",popScoreComposerComplete$composers)
dmitri=as.numeric(popScoreComposerComplete[test,2:175])
qplot(seq_along(dmitri),dmitri)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```


####The Rise of Women Composers
The feminist movements accelerated in 1960s. It first starts in political and economics equality between men and women, and spread to the culture sectors. Can we find this reflected in NY Phil performance data?

We need the proportion of the number of woman composers over the total number of composers whose works are performed by the NY philharmonic over time, but NY Philharmonic's data do not have gender information for each composer. Therefore, I scraped wikipedia pages' listing women composers (https://en.wikipedia.org/wiki/List_of_female_composers_by_birth_year) in python. I computed the proportion of women composers' works performed in each season over the total number of composers whose works are performed by the NY Philharmonic in each season and graphed it. 
 
```{r}
img01 <- readPNG("women.png")
grid.raster(img01)
```

```{r}
women<- read.csv("women.csv", header = FALSE,encoding="UTF-8")
woman1.0=women$V1
woman1.1=strsplit(as.character(woman1.0)," ")
woman1.2=list(rep(0,length(woman1.1)))
for ( i in 1:length(woman1.1)){
  if (length(woman1.1[[i]])>1){
    woman1.2[i]=paste(woman1.1[[i]][length(woman1.1[[i]])],paste(woman1.1[[i]][1:length(woman1.1[[i]])-1], collapse=" "),sep=", ")
  }
}
l=c()
for ( i in 1:length(woman1.2)){
  l=c(l,which(woman1.2[i]==popScoreComposerComplete$composers))
}

woman=popScoreComposerComplete$composers[l]
womanPop=popScoreComposerComplete[l,]
womanPopSum=colSums(womanPop[2:175])
qplot(seq_along(womanPopSum),womanPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
# comp=composerBySeasonComplete[2:175]
# test=list(rep(0, nrow(comp)))
# for (i in 1: nrow(comp)){
#     test[i]<- min(which(!is.na(comp[i,])))
# }
# test=unlist(test)
# 
# firstPerf=colnames(comp)[test]
# 
# firstPerf1=list(rep(0, nrow(comp)))
# for (i in 1:length(firstPerf)){
#   firstPerf1[i]=(unlist(strsplit(firstPerf[i],"\\."))[2])
# }
# firstPerf1=unlist(firstPerf1)
# Name1=as.character(composerBySeasonComplete$composers)
# compContemp=as.data.frame(cbind(Name1,firstPerf1))
# 
# test=merge(compContemp,dyear)
# l=c()
# for (i in 1:nrow(test)){
#   if (as.numeric(test[i,2])<as.numeric(test[i,3])){
#     l=c(l,i)
#   }
# }
# contempComp=test[l,]
# contempComp=contempComp$Name1
# 
# l=c()
# for (i in 1:length(contempComp)){
#   l=c(l,which(contempComp[i]==popScoreComposerComplete$composers))
# }
# contem=unique(popScoreComposerComplete[l,])
l=c()
for ( i in 1:length(woman1.2)){
  l=c(l,which(woman1.2[i]==contem$composers))
}
contempWomen=contem$composers[l]
```

```{r}
l=c()
for ( i in 1:length(contempWomen)){
  l=c(l,which(contempWomen[i]==contem$composers))
}

contemporarywoman=contem$composers[l]
contemporarywomanPop=contem[l,]
contemporarywomanPopSum=colSums(contemporarywomanPop[2:175])
qplot(seq_along(contemporarywomanPopSum),contemporarywomanPopSum)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842:2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```

```{r}
#womancomposers <- read.csv("womancomposers.csv", header = FALSE, quote = "'")
#womenAsChar <- character(ncol(womancomposers))
#for (i in 1:ncol(womancomposers)) {
#  womanString <- as.character(womancomposers[1,i])
#  if (substr(womanString, 1, 1) == " ") womanString <- substr(womanString, 2, nchar(womanString))
#  if (substr(womanString, 1, 1) == "u") womanString <- substr(womanString, 2, nchar(womanString))
#  womenAsChar[i] <- womanString # as.character(womancomposers[1,i])
#}

#l=c()
#for ( i in 1:length(womenAsChar)){
#  l=c(l,which(womenAsChar[i]==popScoreComposerComplete$composers))
#}


#womancom=popScoreComposerComplete[l,]
#womancomoScore=colSums(womancom[2:175])
#plot(womancomoScore, type = "l")

#malecom=popScoreComposerComplete[-l,]
#malecomoScore=colSums(malecom[2:175])
#plot(malecomoScore, type = "l")

#require(ggplot2)
#qplot(seq_along(womancomoScore),womancomoScore)+geom_line()+ylim(0,1)+geom_area(colour="black")+ scale_x_discrete(labels =(1842 :2015))+ theme(axis.text.x = element_text(angle = 90,size=5, hjust = 1))
```
The graph shows that there is not much increase in the proportion of the number of women composers over time. However, this does not show that women are not becoming more and more important in the field of classical music because there are so few of them in Baroque, classical and romantical era when nearly all composers were male. The existence of a meaningful number of women composer starts only recently. Therefore, the next step is to restrict the time-range of this comparison to wehre there is meaningful data-limit the analysis to living composers only. 


to do:
1. matching algorith for death year and pop score: year die>earliest work present season


4. gdp data
5. french imporessionist
6. better graph
7. add gershwin and kate soper or not

