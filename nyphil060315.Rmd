---
title: "Reflection on NY Phil ¨C The NY Phil as a lens on changes in classical music culture"
output: html_document
---
Around the turn of the century, New York City became the arts center of the world. A major factor was the establishment and expansion of the New York Philharmonic which not only encouraged the flourishing of American musicians but also attracted musicians from all over the world to NYC. In this research, I would like to study the performance history of the New York Philharmonic, analyze and visualize the changes of diversity in composers and the form of stardom in performers over time.  

I would first like to study changes in diversity in composers over time using factors like repertoire, composer, performer and their origins. Originally, these were very limited but with time the music increased in diversity as the number of performances increased. Therefore, I want to compute a popularity score to even out the increase of numbers of performances. I want to see with the rise of NYC as the center of art and culture, will there be a change from the strongly Euro-centric, older(deceased), male composers. I will get nationality, gender, birth year data by scraping websites like Wikipedia.  

As classical music became commercialized over time with broadcast and the rise of the recording industry, film scores, etc., solo performers rose to prominence. I would like to measure this trend using the NY Phil¡¯s concert history data. There are some concerts featuring soloists, and there are concerts featuring a theme and fit the soloist into the work. I would like to see how the popularity score for each of these two kinds of concerts change over time. In addition, I¡¯m curious to know the top ten soloists appeared in concerts featuring single soloist, and top ten composers played by concerts featuring one soloist, and top ten pieces featuring one soloist. 


to do:
xml file in R
1. compute popularity score for each composer: https://raw.githubusercontent.com/nyphilarchive/PerformanceHistory/master/Programs/complete.xml
2. compute popularity score for each pianist ??
3. popularity score for soloists for concerts featuring one soloist.

scraping:
1.composer nationality: https://en.wikipedia.org/wiki/Category:Classical_composers_by_nationality (into a table ??)
2.female composer https://en.wikipedia.org/wiki/List_of_female_composers_by_birth_year (match?)
3.american composer with born year https://en.wikipedia.org/wiki/List_of_American_composers

visualization example: http://woojink.com/moma/

1. computing the popularity score for composers
```{r, eval=FALSE}
require("XML")
#require(RCurl)
#xmlfile <- xmlParse("complete.xml")
xmlfile <- xmlParse("~/GitHub/azhangproject/complete.xml")
rootnode = xmlRoot(xmlfile) #gives content of root

incrementComp <- function(composer_stats, c, season){
  if (is.null(composer_stats[c, season])) {
    composer_stats[c, season] <- 1
  } else if (is.na(composer_stats[c,season])) {
    composer_stats[c, season] <- 1
  } else {
    composer_stats[c, season] <- composer_stats[c, season] + 1
  }
  return(composer_stats)
}

composerBySeasonComplete <- read.csv("~/GitHub/azhangproject/composerBySeasonComplete.csv", row.names=1)


composerBySeasonComplete <- data.frame()
for (seas in 1:xmlSize(rootnode)) {
  # DEBUG: cat(seas, "\n")
  firstlist <- xmlToList(rootnode[[seas]])
  season <- firstlist$season
  season <- paste("Season",season,sep=".")
  works <- firstlist$worksInfo
  if (is.list(works)) {     # sometimes works is actually empty
      for (i in 1:length(works)) {
        if (!is.null(works[[i]]$composerName)) {    #sometimes there is no composer
          composerBySeasonComplete <- incrementComp(composerBySeasonComplete, works[[i]]$composerName,season)
        }
      }
    }
}
colnames(composerBySeasonComplete)[1]="composers"
#write.csv(composerBySeasonComplete, "composerBySeasonComplete.csv")

```

```{r, eval=FALSE}
require(base)
composerBySeasonComplete[is.na(composerBySeasonComplete)] <- 0
composerBySeasonComplete1=composerBySeasonComplete[2:175]
composerBySeasonComplete2=composerBySeasonComplete[1]
popScoreComposerComplete=data.frame()
totalNumConcert=colSums(composerBySeasonComplete1, na.rm=TRUE)
for ( i in 1:2652){
  popScoreComposerComplete[i,]=composerBySeasonComplete1[i,]/totalNumConcert
  i=i+1
}
popScoreComposerComplete=cbind(composerBySeasonComplete2,popScoreComposerComplete)
write.csv(popScoreComposerComplete,"popScoreComposerComplete.csv")
```

top ten popular composers
```{r,eval=FALSE}
popScoreSumComp=rowSums(popScoreComposerComplete[2:175],na.rm=TRUE)
popScoreSumComp=cbind(popScoreComposerComplete[1],popScoreSumComp)
popScoreSumComp1=popScoreSumComp[order(-popScoreSumComp$popScoreSumComp),]
test1=rowSums(popScoreSumComp1$popScoreSumComp)
head(popScoreSumComp1,20)
```

graphing composers'popularity scores over time
```{r,eval=FALSE}

test=popScoreComposerComplete[1,]
test=test[2:175]
test=unlist(test)
par(mar = rep(1,4))

require(ggplot2)
points(test,y=NULL)
plot(as.double(popScoreComposerComplete[1,2:ncol(popScoreComposerComplete)]), type = "l")
require(ggplot2)
qplot(seq_along(as.double(popScoreComposerComplete[770,2:ncol(popScoreComposerComplete)])),as.double(popScoreComposerComplete[770,2:ncol(popScoreComposerComplete)]))+geom_line()+ylim(0,1)+geom_area(colour="black")

```


2. computing the popularity score for pianist
```{r,eval=FALSE}
soloistBySeasonComplete <- data.frame()
for (seas in 1:xmlSize(rootnode)) {
  # DEBUG: cat(seas, "\n")
  firstlist <- xmlToList(rootnode[[seas]])
  season <- firstlist$season
  season <- paste("Season",season,sep=".")
  worksInfo <- firstlist$worksInfo
  if (!is.list(worksInfo)) next
  #if ((is.null(worksInfo)) || is.na(worksInfo)) next
  works = worksInfo$work
  if (is.list(works)) {  # sometimes works is actually empty
  soloists = works$soloists
  if (!is.list(soloist)) next
  soloist=soloists$soloist
  if (!is.list(soloist)) next
      for (i in 1:length(soloist)) {
        if (!is.null(soloist[i]$soloistName) && !is.null(soloist[i]$soloistInstrument) && !is.na(soloist[i]$soloistInstrument) && (soloist[i]$soloistInstrument=="Piano")) {    #sometimes there is no composer
          soloistBySeasonComplete <- incrementComp(soloistBySeasonComplete, soloist[i]$soloistName,season)
        }
      }
    }
}
write.csv(soloistBySeasonComplete,"soloistBySeasonComplete.csv")
```

3.woman composers

```{r, eval=FALSE}
womancomposers <- read.csv("womancomposers.csv", header = FALSE, quote = "'")
womenAsChar <- character(ncol(womancomposers))
for (i in 1:ncol(womancomposers)) {
  womanString <- as.character(womancomposers[1,i])
  if (substr(womanString, 1, 1) == " ") womanString <- substr(womanString, 2, nchar(womanString))
  if (substr(womanString, 1, 1) == "u") womanString <- substr(womanString, 2, nchar(womanString))
  womenAsChar[i] <- womanString # as.character(womancomposers[1,i])
}


t=rep(0,length(womenAsChar))
for ( i in 1:length(womenAsChar)){
  if (length(grep(womenAsChar[i], popScoreComposerComplete$composers)==0)){
      t[i]=0
  }else if (length(grep(womenAsChar[i], popScoreComposerComplete$composers)==1)) {
      t[i]=grep(womenAsChar[i], popScoreComposerComplete$composers)
  }else if (length(grep(womenAsChar[i], popScoreComposerComplete$composers)>1)){
      t[i]=as.single(grep(womenAsChar[i], popScoreComposerComplete$composers))
  }
}

womancom=popScoreComposerComplete[test,]
womancomoScore=colSums(womancom[2:175])
plot(womancomoScore, type = "l")

malecom=popScoreComposerComplete[-test,]
malecomoScore=colSums(malecom[2:175])
plot(malecomoScore, type = "l")

require(ggplot2)
qplot(seq_along(womancomoScore),womancomoScore)+geom_line()+ylim(0,1)+geom_area(colour="black")
```
composers
```{r}
composers <- read.csv("composers.csv", header = FALSE, quote = ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,", encoding = "UTF-8")
```

